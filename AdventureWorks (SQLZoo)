This data is based on Microsoft's AdventureWorks database.

Q: Show the first name and the email address of customer with CompanyName 'Bike World'.

SELECT firstname, emailaddress
FROM Customer
WHERE companyname = "Bike World";

Q: Show the CompanyName for all customers with an address in City 'Dallas'.

SELECT companyname
FROM Customer AS cust
JOIN CustomerAddress AS custa ON cust.customerid = custa.customerid
JOIN Address AS a ON custa.addressid = a.addressid
WHERE city = "Dallas";

Q: How many items with ListPrice more than $1000 have been sold?

SELECT SUM(orderqty) AS Num_Sold
FROM SalesOrderDetail
WHERE productid IN (SELECT productid 
                    FROM Product 
                    WHERE listprice > 1000);

Q: Give the CompanyName of those customers with orders over $100000. Include the subtotal plus tax plus freight.

SELECT companyname
FROM Customer AS c
JOIN SalesOrderHeader AS soh ON c.customerid = soh.customerid
WHERE commnt > 100000;

Q: Find the number of left racing socks ('Racing Socks, L') ordered by CompanyName 'Riding Cycles'.

SELECT SUM(orderqty) AS Num_Ordered
FROM Customer AS c
JOIN SalesOrderHeader AS soh ON c.customerid = soh.customerid
JOIN SalesOrderDetail AS sod ON soh.salesorderid = sod.salesorderid 
JOIN Product AS p ON sod.productid = p.productid
WHERE companyname = "Riding Cycles" AND name = "Racing Socks, L";

Q: A "Single Item Order" is a customer order where only one item is ordered. Show the SalesOrderID and the UnitPrice 
for every Single Item Order.

SELECT salesorderid, unitprice
FROM SalesOrderDetail
WHERE salesorderid IN (
                       SELECT salesorderid
                       FROM SalesOrderDetail
                       GROUP BY salesorderid
                       HAVING COUNT(productid) = 1
                       );

Q: Where did the racing socks go? List the product name and the CompanyName for all Customers who ordered ProductModel 
'Racing Socks'.

SELECT name, companyname
FROM Product AS p
RIGHT JOIN SalesOrderDetail AS sod ON p.productid = sod.productid
JOIN SalesOrderHeader AS soh ON sod.salesorderid = soh.salesorderid 
JOIN Customer AS c ON soh.customerid = c.customerid
WHERE productmodelid = (SELECT productmodelid FROM ProductModel WHERE name LIKE "%Racing Socks%")

Q: Show the product description for culture 'fr' for product with ProductID 736.

SELECT description
FROM ProductDescription AS pd 
JOIN ProductModelProductDescription AS pmpd ON pd.productdescriptionid = pmpd.productdescriptionid
JOIN ProductModel AS pm ON pmpd.productmodelid = pm.productmodelid
JOIN Product AS p ON pm.productmodelid = p.productmodelid
WHERE culture = "fr" AND productid = 736;

Q: Use the SubTotal value in SaleOrderHeader to list orders from the largest to the smallest. For each order show the 
CompanyName and the SubTotal and the total weight of the order.

SELECT salesorderid, companyname, subtotal, freight
FROM SalesOrderHeader AS soh
LEFT JOIN Customer AS c ON soh.customerid = c.customerid
ORDER BY subtotal DESC;

Q: How many products in ProductCategory 'Cranksets' have been sold to an address in 'London'?

SELECT SUM(orderqty) AS Num_Products 
FROM Product AS p
RIGHT JOIN SalesOrderDetail AS sod ON p.productid = sod.productid
JOIN SalesOrderHeader AS soh ON sod.salesorderid = soh.salesorderid 
LEFT JOIN Address AS a ON soh.billtoaddressid = a.addressid
WHERE productcategoryid = (SELECT productcategoryid FROM ProductCategory WHERE name LIKE "%Cranksets%") 
      AND city = "London";

Q: For every customer with a 'Main Office' in Dallas show AddressLine1 of the 'Main Office' and AddressLine1 of the 
'Shipping' address - if there is no shipping address leave it blank. Use one row per customer.

SELECT main_addresses.customerid, main, shipping
FROM
(
SELECT customerid, addressline1 AS main
FROM CustomerAddress AS ca
JOIN Address AS a ON ca.addressid = a.addressid 
WHERE addresstype = "Main Office" AND city = "Dallas"
) AS main_addresses
LEFT JOIN 
(
SELECT customerid, addressline1 AS shipping
FROM Address AS a 
JOIN CustomerAddress AS ca ON a.addressid = ca.addressid 
WHERE addresstype = "Shipping"
) AS shipping_addresses
ON main_addresses.customerid = shipping_addresses.customerid

Q: For each order show the SalesOrderID and SubTotal calculated three ways:
A) From the SalesOrderHeader
B) Sum of OrderQty*UnitPrice
C) Sum of OrderQty*ListPrice

SELECT soh.salesorderid, subtotal AS c1, SUM(orderqty*unitprice) AS c2, SUM(orderqty*listprice) AS c3
FROM SalesOrderHeader AS soh 
JOIN SalesOrderDetail AS sod ON soh.salesorderid = sod.salesorderid
LEFT JOIN Product AS p ON sod.productid = p.productid
GROUP BY salesorderid, c1

Q: Show how many orders are in the following ranges (in $):
RANGE      Num Orders      Total Value
0-99
100-999
1000-9999
10000-

SELECT
    CASE 
        WHEN commnt BETWEEN 0 AND 99 THEN '0-99'
        WHEN commnt BETWEEN 100 AND 999 THEN '100-999'
        WHEN commnt BETWEEN 1000 AND 9999 THEN '1000-9999'
        WHEN commnt >= 10000 THEN '10000+'
    END AS Num_Range,
    COUNT(salesorderid) AS Num_Orders,
    ROUND(SUM(commnt), 2) AS Total_Value
FROM SalesOrderHeader
GROUP BY
    CASE 
        WHEN commnt BETWEEN 0 AND 99 THEN '0-99'
        WHEN commnt BETWEEN 100 AND 999 THEN '100-999'
        WHEN commnt BETWEEN 1000 AND 9999 THEN '1000-9999'
        WHEN commnt >= 10000 THEN '10000+'
    END
ORDER BY Num_Range ASC;

Q: Identify the three most important cities. Show the break down of top level product category against city.

-- Top 3 cities by dollar value (Woolston, London, Union City) 
SELECT city, SUM(orderqty*unitprice) AS Total_Value
FROM Address AS a
LEFT JOIN SalesOrderHeader AS soh ON a.addressid = soh.billtoaddressid
JOIN SalesOrderDetail AS sod ON soh.salesorderid = sod.salesorderid
GROUP BY city
ORDER BY Total_Value DESC
LIMIT 3

-- Breakdown of top level product categories by city dollar value and percentage of total value
SELECT 
      pc.name AS Product_Category, 
      Woolston_Value, 
      ROUND((Woolston_Value/SUM(orderqty*unitprice))*100, 2) AS Woolston_Percent,
      London_Value, 
      ROUND((London_Value/SUM(orderqty*unitprice))*100, 2) AS London_Percent,
      UnionCity_Value, 
      ROUND((UnionCity_Value/SUM(orderqty*unitprice))*100, 2) AS UnionCity_Percent,
      SUM(orderqty*unitprice) AS Total_Value
FROM ProductCategory AS pc
LEFT JOIN 
(
SELECT pc.name, SUM(orderqty*unitprice) AS Woolston_Value
FROM ProductCategory AS pc
LEFT JOIN Product AS p ON pc.productcategoryid = p.productcategoryid
LEFT JOIN SalesOrderDetail AS sod ON p.productid = sod.productid
JOIN SalesOrderHeader AS soh ON sod.salesorderid = soh.salesorderid 
JOIN Address AS a ON soh.billtoaddressid = a.addressid 
WHERE city = "Woolston"
GROUP BY pc.name
) AS w ON pc.name = w.name
LEFT JOIN 
(
SELECT pc.name, SUM(orderqty*unitprice) AS London_Value
FROM ProductCategory AS pc
LEFT JOIN Product AS p ON pc.productcategoryid = p.productcategoryid
LEFT JOIN SalesOrderDetail AS sod ON p.productid = sod.productid
JOIN SalesOrderHeader AS soh ON sod.salesorderid = soh.salesorderid 
JOIN Address AS a ON soh.billtoaddressid = a.addressid 
WHERE city = "London"
GROUP BY pc.name
) AS l ON pc.name = l.name
LEFT JOIN 
(
SELECT pc.name, SUM(orderqty*unitprice) AS UnionCity_Value
FROM ProductCategory AS pc
LEFT JOIN Product AS p ON pc.productcategoryid = p.productcategoryid
LEFT JOIN SalesOrderDetail AS sod ON p.productid = sod.productid
JOIN SalesOrderHeader AS soh ON sod.salesorderid = soh.salesorderid 
JOIN Address AS a ON soh.billtoaddressid = a.addressid 
WHERE city = "Union City"
GROUP BY pc.name
) AS uc ON pc.name = uc.name
LEFT JOIN Product AS p ON pc.productcategoryid = p.productcategoryid
LEFT JOIN SalesOrderDetail AS sod ON p.productid = sod.productid
GROUP BY pc.name, Woolston_Value, London_Value, UnionCity_Value
ORDER BY Total_Value DESC
